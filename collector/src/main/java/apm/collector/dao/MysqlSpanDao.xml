<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="apm.collector.dao.MysqlSpanDao">
    <insert id="insertSpanAndGetId" useGeneratedKeys="true" keyProperty="spanId"
            parameterType="apm.collector.dao.MysqlSpan">


        insert into
      span
      (transactionId,agentId,agentStartTime,transactionSequence,
      acceptedTime,type,applicationId,version,
      serviceType,parentSpanId,startTime,elapsed,
      rpc,endPoint,remoteAddr,apiId,
      errCode,exceptionId,exceptionMessage,flag,
      loggingTransactionInfo,acceptorHost
      )
       values(
      #{transactionId}, #{agentId}, #{agentStartTime},${transactionSequence},
      #{acceptedTime},#{type},#{applicationId},#{version},
      #{serviceType},#{parentSpanId},#{startTime},#{elapsed},
      #{rpc},#{endPoint},#{remoteAddr},#{apiId},
      #{errCode},#{exceptionId},#{exceptionMessage},#{flag},
      #{loggingTransactionInfo},#{acceptorHost}
      )
    </insert>

    <insert id="insertSpanEvent" parameterType="apm.collector.dao.MysqlSpanEvent">
        insert into
      span_event
      (transactionId,spanId,startElapsed,endElapsed,
      sequence,depth,serviceType,rpc,
      endPoint,destinationId,apiId,nextSpanId,
      exceptionId,exceptionMessage,nextAsyncId,sqlId,
      parentSpaneventId,nextSpaneventId,beforeSpaneventId

      )
       values(
      #{transactionId}, #{spanId}, #{startElapsed},${endElapsed},
      #{sequence},#{depth},#{serviceType},#{rpc},
      #{endPoint},#{destinationId},#{apiId},#{nextSpanId},
      #{exceptionId},#{exceptionMessage},#{nextAsyncId},#{sqlId},
      #{parentMysqlSpanEventId},#{beforeMysqlSpanEventId},#{afterMysqlSpanEventId}
      )
    </insert>

    <insert id="insertTransaction" parameterType="apm.collector.dao.MysqlTransaction">
        insert into
      transaction
      (id,rpc,startTime,elapsed,
      endtime,application_id
      )
       values(
      #{id}, #{rpc}, #{startTime},${endTime},
      #{elapsed},#{appllicationId}
      )
    </insert>

</mapper>
