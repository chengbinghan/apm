<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="apm.web.dao.apmmysql.CallerMapDao">

    <select id="getAppCallerByAppId" parameterType="String" resultMap="CallerMapMap">
    SELECT  *  FROM map_statistics_caller m1 WHERE caller_appId = #{appId};
</select>

    <select id="getAppCalleeCountByAppId" parameterType="hashMap" resultMap="CallerMapVOMap">

SELECT
  m1.callee_appId,
  aer.applicationName as applicationerName,
  aer.applicationType as applicationerType,
  aee.applicationName as applicationeeName,
  aee.applicationType as applicationeeType,

  count(1) AS counts
FROM
  map_statistics_caller m1, application aer, application aee

WHERE m1.caller_appId = #{appId} AND m1.timestamp  &lt; #{currentTime} AND m1.timestamp &gt; (#{currentTime} - #{timeSection}) AND aer.id = m1.caller_appId AND aee.id = m1.callee_appId
GROUP BY
  m1.callee_appId;
    </select>


    <resultMap type="apm.web.beans.module.CallerMap" id="CallerMapMap">

        <id property="callerId" column="callerId"/>
        <id property="timestamp" column="timestamp"/>
        <result property="callerCode" column="caller_code"/>
        <result property="callerDesc" column="caller_desc"/>
        <result property="calleeCode" column="callee_code"/>
        <result property="calleeDesc" column="callee_desc"/>
        <result property="isError" column="isError"/>
        <result property="callerAppId" column="caller_appId"/>
        <result property="calleeAppId" column="callee_appId"/>
        <result property="callTimes" column="count"/>

    </resultMap>

    <resultMap type="apm.web.beans.vo.CallerMapVO" id="CallerMapVOMap">


        <result property="callerMap.callerId" column="callerId"/>
        <result property="callerMap.timestamp" column="timestamp"/>
        <result property="callerMap.callerCode" column="caller_code"/>
        <result property="callerMap.callerDesc" column="caller_desc"/>
        <result property="callerMap.calleeCode" column="callee_code"/>
        <result property="callerMap.calleeDesc" column="callee_desc"/>
        <result property="callerMap.isError" column="isError"/>
        <result property="callerMap.callerAppId" column="caller_appId"/>
        <result property="callerMap.calleeAppId" column="callee_appId"/>
        <result property="apperName" column="applicationerName"/>
        <result property="apperType" column="applicationerType"/>
        <result property="appeeName" column="applicationeeName"/>
        <result property="appeeType" column="applicationeeType"/>

        <result property="callerMap.calleeAppId" column="callee_appId"/>


        <result property="callTimes" column="counts"/>
    </resultMap>


</mapper>
