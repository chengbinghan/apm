<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="apm.web.dao.apmmysql.MonitorDao">




    <select id="getMonitorsByIds"  resultMap="MonitorMap">

        SELECT
        m1.id as id ,
        m1.rpm as rpm,
        m1.threshold as threshold,
        m1.time as timesection,
        m1.type as type

        FROM
        monitor m1
        WHERE id in
        <foreach item="id" index="index"  collection="monitorsIdArr" open="( " separator="," close=" )">
            #{id}
        </foreach>

    </select>
    <select id="getMaxMonitorId" resultType="Integer">


        SELECT max(m1.id) FROM monitor m1
    </select>

    <insert id="addMonitor" parameterType="apm.web.beans.module.Monitor">

          insert into monitor(id, rpm,time,type,threshold) values(#{id}, #{rpm}, #{time}, #{type}, #{threshold})

    </insert>
    <insert id="addMonitorStrategy" parameterType="apm.web.beans.module.MonitorStrategy">

          insert into monitorstrategy(name,type,monitors) values(#{name}, #{type}, #{monitors})

    </insert>


    <insert id="addMonitorPro" parameterType="hashMap" >
      insert into monitorpro(appId,userId,strategyId) values(#{appId}, #{userId}, #{strategyId})

    </insert>

    <select id="findMonitorStrategy" resultMap="MonitorStrategyMap">

        select
        ms1.id as id,
        ms1.name as name,
        ms1.type as type,
        ms1.monitors as monitors
         from monitorstrategy ms1;


    </select>

    <resultMap id="MonitorStrategyMap" type="apm.web.beans.module.MonitorStrategy">
        <result property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="type" column="type"/>
        <result property="monitors" column="monitors"/>

    </resultMap>



    
    <resultMap id="MonitorMap" type="apm.web.beans.module.Monitor">

        <result property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="type" column="type"/>
        <result property="threshold" column="threshold"/>
        <result property="rpm" column="rpm"/>
        <result property="time" column="timesection"/>

    </resultMap>


<!--
    private Integer id;
    private String name;
    //type可以是apdex,响应时间
    private String type;
    private String description;

    //阈值
    private String threshold;

    //持续时间
    private Integer time;

    //rpm 值
    private Integer rpm ;-->



</mapper>
